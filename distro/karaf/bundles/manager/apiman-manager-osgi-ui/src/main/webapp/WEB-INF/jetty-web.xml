<?xml version="1.0"?>
<!DOCTYPE Configure PUBLIC "-//Mort Bay Consulting//DTD Configure//EN"
        "http://www.eclipse.org/jetty/configure_9_0.dtd">

<Configure class="org.eclipse.jetty.webapp.WebAppContext">

    <!--  Keycloak Authentication
    <Get name="securityHandler">
            <Set name="authenticator">
                <New class="org.keycloak.adapters.jetty.KeycloakJettyAuthenticator"></New>
            </Set>
     </Get>
    -->

    <!-- Configure the Jetty Security Handler to use the JAAS Login Service with the apiman realm -->
    <Get name="securityHandler">
        <Set name="loginService">
            <New class="org.eclipse.jetty.plus.jaas.JAASLoginService" id="jaasLoginService">
                <Set name="name">apiman</Set>
                <Set name="loginModuleName">apiman</Set>
                <Set name="roleClassNames">
                    <Array type="java.lang.String">
                        <Item>org.apache.karaf.jaas.boot.principal.RolePrincipal</Item>
                    </Array>
                </Set>
            </New>
        </Set>
        <!-- Required to avoid this error : No authenticator for: {RoleInfo,C[admin, apipublisher]} -->
        <Set name="realmName">apiman</Set>
        <!-- Configure Basic Authentication mode -->
        <Set name="authenticator">
            <New class="org.eclipse.jetty.security.authentication.BasicAuthenticator"></New>
        </Set>
    </Get>
</Configure>